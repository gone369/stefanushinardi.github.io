<!-- 
    code inspired by: http://codepen.io/anon/pen/LVYvrV.html
-->
<meta charset="utf-8">

<head>

  <title>Celebrity Feud Network</title>

  <!-- Tags for setting default content when sharing on social media -->

  <!-- d3plus requires d3 libraries -->
  <script src="js/d3.js"></script>
  <script src="js/d3plus.js"></script>

  <!-- Bootstrap styles for the tables -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  <style>
    html, body { height: 100% }
    
    #viz { 
        height: 95%;
        min-height: 600px; /* to ensure that we have enough space to render the viz on a small screen, even if it requires scrolling */
        min-width: 780px;
        z-index: 1
    }
    #d3plus_back_button{
        padding-top: 25px;
        padding-left: 15px;

    }
    #d3plus_back_button > a{
        font-size: 30px;
    }
    .navbar-nav > li > a {padding-top:10px !important; padding-bottom:5px !important;}
    .navbar-brand{padding-top:10px !important; padding-bottom:5px !important;}
    .navbar {min-height:32px !important}

  </style>

</head>

<body>
    <nav class="navbar navbar navbar-fixed-top " style="height:20px">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Feud Network</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a data-toggle="modal" data-target="#basicModal">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <br>
    <div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h4 class="modal-title" id="myModalLabel">About</h4>
            </div>
            <div class="modal-body">
                <p> This network graph visualization tries to depict the network connection between celebrites based on their twitter war</p>
                <p>The node represents each celebrity, with the area of the circle represents the number of followers. The color represents the number of in and out degress of a particular node, based on the gradient at the bottom of the page.</p>
                <p>The edge represents exchange of tweets, with opacity represents the number of exchanges as well as the type of tweet exchanges. Low opacity represents indirect exchanges and higher opacity represents direct exchanges</p>
                <p>To explore, click on the node to focus on that node, and read the top tweets on the right(based on number of likes and retweets)</p>

                <p>To undo, press the back button on the top left</p>
                <p>Lastly, enjoy the <i>beef</i>!</p>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>
  </div>
</div>

  <div id="viz"></div>
  

  <script>
    // This is the public feed generated by a custom standalone google apps script, which reads my Google Sheet with the links and returns a json
    var spreadsheetFeed = "./data.json";
    
    
    var links, nodes;
    var edgeOpacities = {   'direct': 0.8,
                            'indirect': 0.2,
                            'none'        : 0
                        };
    
    d3.json(spreadsheetFeed, function(graph) {
        
        //links = graph.links;        // this was used when reading from a static local json file
        links = graph;
        nodes = {};
        console.log(graph);
        // Compute the distinct nodes from the links.
        links.forEach(function(link) {
            addNode(link.source, link, link.target, link.episode, link.sourceFollowers);
            addNode(link.target, link, link.source, link.episode, link.targetFollowers);    
        });
        // Build the d3plus rings visualization
        var visualization = d3plus.viz()
        .container("#viz")
        .type("rings")
        .edges({          
            "color": "#AAA",
            "opacity": function(d) {
                return edgeOpacities[d.type] ? edgeOpacities[d.type] : 0.5;
            },
            "value": links,
        })
        .data(d3.values(nodes))     
        .zoom({"click" : true})
        .tooltip({
            "html": function(d) {
                var neighbors = nodes[d].neighbors;
                var html = "<table class='table table-striped'>";        
                html += "<tr><th>From</th><th>to</th><th>Top Tweet</th></tr>";
                neighbors.forEach(function(n) {
                    html += "<tr><td>" + n.link.from + "</td><td>" + n.link.to + "</td><td>" + n.link.tweet + "</td></tr>";
                });
                html += "</table>";
                return html;
            },
            "connections": false,  
            "large": 400,          
        })
        .size("followers")            
        .id("name")                
        .focus("Kanye West") 
        .color("degree")
        .draw();
    });
    
    function addNode(n, link, m, year, followers) {
        // Either creates a node or adds to an existing node
        if (!(n in nodes)) {
            nodes[n] = {};
            nodes[n].name = n;
            nodes[n].degree = 1;
            nodes[n].neighbors = [ {"name": m, "link": link} ];    
            nodes[n].followers = followers;
            nodes[n].year = year;
        }
        else {
            nodes[n].degree += 1;
            nodes[n].neighbors.push({"name": m, "link": link});
        }
    }
  </script>

</body>
